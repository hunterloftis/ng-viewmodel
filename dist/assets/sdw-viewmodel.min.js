/**
 * sdw-viewmodel - v0.0.1 - 2013-10-07
 * 
 *
 * Copyright (c) 2013 Hunter Loftis
 * Licensed MIT <https://raw.github.com/joshdmiller/ng-boilerplate/master/LICENSE>
 */
!function(a,b,c){b.module("sdw.viewmodel",[]).provider("viewmodel",function(){function a(a){function b(a,b){var c=d.params[b];e[c]=a}for(var d,e={},f=0;f<j.length;f++)if(d=j[f],paramValues=a.match(d.regex))return paramValues.slice(1).forEach(b),{state:d.state,params:e};return c}function b(a){for(var b,c="",d=[],e="^"+a.replace(/[-\/\\^$:*+?.()|[\]{}]/g,"\\$&")+"$",f=/\\([:*])(\w+)/g,g=0;null!==(b=f.exec(e));)c+=e.slice(g,b.index),":"===b[1]?c+="([^\\/]*)":"*"===b[1]&&(c+="(.*)"),d.push(b[2]),g=f.lastIndex;return c+=e.slice(g),{string:c,re:new RegExp(c,"i"),params:d}}function d(a,b,c){function d(a){var b=a.action;b&&b(f,c)}var f={},g=e(h,b);g.forEach(d),a.$broadcast("viewmodel:state",f)}function e(a,b){for(var c,d=b.split("."),e=[],f=1;f<=d.length;f++)c=d.slice(0,f).join("."),e.push(a[c]);return e}var f,g=this,h={},i={},j=[];this.state=function(a,b){return h[a]={route:b.route,action:b.action},this},this.param=function(a,b){i[a]=b},this.fallback=function(a){return f=a,this},this.$get=["$rootScope","$location","$routeParams",function(c,k){function l(a){function c(a){d+=a.route}var d="",f=e(h,a);f.forEach(c);var g=b(d);j.push({string:d,state:a,regex:g.re,params:g.params})}function m(){var b=a(k.path());b?d(c,b.state,b.params):f?d(c,f,{}):applyDefaults();var e=k.search(),g={};for(var h in i)"undefined"!=typeof e[h]&&i[h](g,e[h]);c.$broadcast("viewmodel:state",g)}Object.keys(h).forEach(l),c.$on("$locationChangeSuccess",m),g.applyState=d}]}).directive("sdwViewmodel",["$rootScope","viewmodel",function(a){function b(b,c,d){function e(a,c){for(var d in c)b[f][d]=c[d]}var f=d.model||d.sdwViewmodel;b[f]=b[f]||{},a.$on("viewmodel:state",e)}return{restrict:"EA",link:b}}]),b.module("dtv.demo.routes",["sdw.viewmodel"]).config(["viewmodelProvider",function(a){a.otherwise("browse").state("browse",{route:"",action:function(a){a.showModal=!1}}).state("browse.movie",{route:"/movie/:movie",action:function(a,b){a.showModal=!0,a.modalView="movie",a.movieId=+b.movie}}).state("browse.movie.rent",{route:"/rent",action:function(a){a.modalView="rent"}}).state("browse.celebrity",{route:"/celebrity/:celeb",action:function(a,b){a.showModal=!0,a.modalView="celebrity",a.celebId=+b.celeb}})}]).controller("RouteController",["$scope","$location","viewmodel",function(a,b){a.movies=[{id:123,title:"The Shawshank Redemption",celeb:333},{id:234,title:"Garden State",celeb:444},{id:345,title:"Crouching Tiger, Hidden Dragon",celeb:555}],a.celebs=[{id:333,name:"Morgan Freeman"},{id:444,name:"Zach Braff"},{id:555,name:"Chow Yun Fat"}],a.movieData=function(){for(var b=0;b<a.movies.length;b++)if(a.movies[b].id===a.vm.movieId)return a.movies[b]},a.celebData=function(){for(var b=0;b<a.celebs.length;b++)if(a.celebs[b].id===a.vm.celebId)return a.celebs[b]},a.onRent=function(){alert("Rented "+a.movieData().title+"!"),b.path("")}}]),b.module("examples.simple",["sdw.viewmodel"]).config(["viewmodelProvider",function(a){a.fallback("default").state("default",{action:function(a){a.showModal=!1,a.article="",a.showPrice=!1}}).state("article",{route:"/article/:article",action:function(a,b){a.showModal=!0,a.article=b.article}}).state("article.buy",{route:"/buy",action:function(a){a.showPrice=!0}}).param("alt",function(a,b){console.log("alt"),a.useAltStyle="true"===b})}]),b.module("templates-app",[]),b.module("templates-component",[])}(window,window.angular);